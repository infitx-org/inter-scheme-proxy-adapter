version: '3.8'

x-hub: &HUB
  build:
    context: ./docker/echo-server
    dockerfile: Dockerfile
  command: npm start
  restart: always
  env_file: .env


services:
  proxy:
    build:
      context: ./
      dockerfile: Dockerfile
    command: npm start
    restart: on-failure
    env_file: .env
    volumes:
      - ./certs/:/opt/app/certs/
    ports:
      - "${INBOUND_LISTEN_PORT_A}:${INBOUND_LISTEN_PORT_A}"
      - "${INBOUND_LISTEN_PORT_B}:${INBOUND_LISTEN_PORT_B}"

  hub-a:
    <<: *HUB
    ports:
      - "${HUB_A_PORT}:6000"

  hub-b:
    <<: *HUB
    ports:
      - "${HUB_B_PORT}:6000"
